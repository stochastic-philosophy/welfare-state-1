<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moduulien lataus-testi</title>
    <style>
        body { 
            font-family: sans-serif; 
            max-width: 900px; 
            margin: 2rem auto; 
            padding: 1rem;
        }
        .test {
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 5px;
            border-left: 4px solid #666;
        }
        .success { background: #e8f5e9; border-color: #4caf50; }
        .error { background: #ffebee; border-color: #f44336; }
        .waiting { background: #e3f2fd; border-color: #2196f3; }
        code { 
            background: #f5f5f5; 
            padding: 2px 6px; 
            border-radius: 3px;
            font-family: monospace;
        }
        pre {
            background: #f5f5f5;
            padding: 1rem;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 0.85em;
        }
    </style>
</head>
<body>
    <h1>Moduulien lataus-testi</h1>
    <p>Testataan kaikkien moduulien lataus j√§rjestyksess√§...</p>
    
    <div id="results"></div>

    <script type="module">
        const results = document.getElementById('results');
        
        function addTest(name, status, message, details = '') {
            const div = document.createElement('div');
            div.className = `test ${status}`;
            div.innerHTML = `
                <h3>${status === 'success' ? '‚úÖ' : status === 'error' ? '‚ùå' : '‚è≥'} ${name}</h3>
                <p>${message}</p>
                ${details ? `<pre>${details}</pre>` : ''}
            `;
            results.appendChild(div);
        }

        async function testModule(name, path) {
            addTest(name, 'waiting', `Yritet√§√§n ladata tiedostoa: ${path}`);
            
            try {
                const module = await import(path);
                addTest(
                    name, 
                    'success', 
                    `Tiedosto latautui onnistuneesti!`,
                    `Viedyt: ${Object.keys(module).join(', ') || 'default export'}`
                );
                return { success: true, module };
            } catch (error) {
                addTest(
                    name, 
                    'error', 
                    `Lataus ep√§onnistui!`,
                    `Virhe: ${error.message}\n\nStack:\n${error.stack}`
                );
                return { success: false, error };
            }
        }

        // Testataan kaikki moduulit j√§rjestyksess√§
        async function runTests() {
            // 1. Router
            const router = await testModule('router.js', './router.js');
            if (!router.success) return;

            // 2. Utils
            const utils = await testModule('utils.js', './utils.js');
            if (!utils.success) return;

            // 3. Markdown config
            const mdConfig = await testModule('markdown-config.js', './markdown-config.js');
            if (!mdConfig.success) return;

            // 4. HomeController
            const home = await testModule('HomeController.js', './HomeController.js');
            if (!home.success) return;

            // 5. SectionController
            const section = await testModule('SectionController.js', './SectionController.js');
            if (!section.success) return;

            // 6. ChapterController
            const chapter = await testModule('ChapterController.js', './ChapterController.js');
            if (!chapter.success) return;

            // 7. App
            const app = await testModule('app.js', './app.js');
            if (!app.success) return;

            // Jos kaikki onnistui, testaa toiminnallisuutta
            addTest(
                'Toiminnallisuustesti',
                'waiting',
                'Testataan ett√§ moduulit toimivat yhdess√§...'
            );

            try {
                // Testaa slugify
                const { slugify } = utils.module;
                const slug = slugify('T√§m√§ on testi');
                
                // Testaa markdown
                const { md } = mdConfig.module;
                const html = md.render('# Otsikko\n\nTeksti√§ **lihavoituna**');
                
                addTest(
                    'Toiminnallisuustesti',
                    'success',
                    'Kaikki moduulit toimivat!',
                    `slugify("T√§m√§ on testi") = "${slug}"\n\nMarkdown testi:\n${html}`
                );

                // Lopullinen yhteenveto
                const summary = document.createElement('div');
                summary.className = 'test success';
                summary.innerHTML = `
                    <h2>üéâ KAIKKI TESTIT L√ÑP√ÑISTY!</h2>
                    <p>Kaikki moduulit latautuvat ja toimivat oikein.</p>
                    <p><strong>Voit nyt k√§ytt√§√§ normaalia index.html tiedostoa.</strong></p>
                `;
                results.appendChild(summary);

            } catch (error) {
                addTest(
                    'Toiminnallisuustesti',
                    'error',
                    'Moduulit latautuivat mutta eiv√§t toimi oikein',
                    `Virhe: ${error.message}\n\nStack:\n${error.stack}`
                );
            }
        }

        // K√§ynnist√§ testit
        runTests().catch(error => {
            addTest(
                'Kriittinen virhe',
                'error',
                'Testien suoritus ep√§onnistui',
                `${error.message}\n\n${error.stack}`
            );
        });
    </script>
</body>
</html>
